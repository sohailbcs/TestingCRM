

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<!-- partial -->
<div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <p class="card-title"> All Leads</p>
                        <div class="row">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="col-md-12">
                                            <label for="SelectedTeamMember" class="form-label">Team Member</label>
                                            @Html.DropDownList("SelectedTeamMember", ViewBag.UserList as SelectList, "-- Select Team Member --", new { @class = "form-control", id = "SelectedTeamMember" })
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table id="leadDetailsTable" class="display expandable-table" style="width:100%">
                                        <thead class="thead-dark">
                                            <tr>
                                                <th>First Name</th>
                                                <th>Last Name</th>
                                                <th>Phone Number</th>
                                                <th>Lead Creation Date</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>

    </div>

</div>
<!-- main-panel ends -->
@section Scripts {
    <script>
        $(document).ready(function () {
            // Initialize DataTable for lead details without data
            var leadDetailsTable = $('#leadDetailsTable').DataTable({
                paging: true,        // Enable pagination
                ordering: true,      // Enable sorting
                info: true,          // Enable info display
                searching: true,     // Enable search functionality
                responsive: true,    // Enable responsive design for mobile
                lengthChange: true,  // Enable the ability to change the number of items displayed per page
                pageLength: 10,      // Set the default number of items displayed per page
                order: [[0, 'asc']], // Set the default sorting column and order
                columnDefs: [
                    { targets: [0], orderable: true },
                    // Add more columnDefs as needed
                ],
                language: {
                    emptyTable: "No data available in table",
                    info: "Showing _START_ to _END_ of _TOTAL_ entries",
                    infoEmpty: "Showing 0 to 0 of 0 entries",
                    infoFiltered: "(filtered from _MAX_ total entries)",
                    lengthMenu: "Show _MENU_ entries",
                    search: "Search:",
                    zeroRecords: "No matching records found"
                }
            });

            // Hide the 'Show entries' dropdown
            $('.dataTables_length').hide();

            // Attach an event handler to the dropdown change event
            $("#SelectedTeamMember").change(function () {
                // Get the selected team member ID
                var selectedEmployeeId = $(this).val();

                // Check if a team member is selected
                if (!selectedEmployeeId) {
                    // Clear the DataTable if no team member is selected
                    leadDetailsTable.clear().draw();
                    return;
                }

                // Make an AJAX request to retrieve lead data based on the selected team member
                $.ajax({
                    url: "/Admin/LeadManagement/GetLeadDataByEmployeeId",
                    type: "GET",
                    data: { employeeId: selectedEmployeeId },
                    success: function (data) {
                        // Update the lead data display area with the retrieved data
                        $("#leadDataContainer").html(data);

                        // Destroy the DataTable and reinitialize it with the new data
                        leadDetailsTable.clear().destroy();
                        leadDetailsTable = $('#leadDetailsTable').DataTable({
                            paging: true,
                            ordering: true,
                            info: true,
                            searching: true,
                            responsive: true,
                            lengthChange: true,
                            pageLength: 10,
                            order: [[0, 'asc']],
                            columnDefs: [
                                { targets: [0], orderable: true },
                                // Add more columnDefs as needed
                            ],
                            language: {
                                emptyTable: "No data available in table",
                                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                                infoEmpty: "Showing 0 to 0 of 0 entries",
                                infoFiltered: "(filtered from _MAX_ total entries)",
                                lengthMenu: "Show _MENU_ entries",
                                search: "Search:",
                                zeroRecords: "No matching records found"
                            }
                        });

                        // Hide the 'Show entries' dropdown after reinitializing
                        $('.dataTables_length').hide();
                    },
                    error: function (xhr, status, error) {
                        console.log("Error fetching lead data");
                        console.log("Status: " + status);
                        console.log("Error: " + error);
                    }
                });
            });
        });
    </script>
}
