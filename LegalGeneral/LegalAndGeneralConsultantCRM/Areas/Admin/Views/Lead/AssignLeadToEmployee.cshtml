@model LegalAndGeneralConsultantCRM.ViewModels.Leads.LeadEmployeeAssignmentViewModel

<!-- Include EJ2 scripts and stylesheets -->
<link rel="stylesheet" href="https://cdn.syncfusion.com/ej2/16.1.37/material.css" />
<script src="https://cdn.syncfusion.com/ej2/16.1.37/dist/ej2.min.js"></script>
<div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="container-full">

        
        <!-- Main content -->
        <section class="content">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="d-flex align-items-center">
                    <div class="w-p100 d-md-flex align-items-center justify-content-between">
                        <h3 class="page-title">   </h3>
                        <div class="d-inline-block align-items-center">
                            <nav>
                                <ol class="breadcrumb">
                                </ol>
                            </nav>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">

                <div class="col-12">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">Leads Allocation</h3>
                            @if (TempData["SuccessMessage"] != null)
                            {
                                <div class="alert mb-5 mt-2 alert-success alert-dismissible fade show" role="alert">
                                    <strong>Success!</strong> @TempData["SuccessMessage"]
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            }
                        </div>

                        <div class="mt-3">
                            <label><strong>Selected Leads Count:</strong> <span id="lead-counter">0</span></label>
                        </div>

                        <!-- /.box-header -->
                        <div class="box-body">
                            <div class="table-responsive">
                                <div class="row">

                                    <div class="col-12">

                                        <form asp-action="AssignLeadToEmployee" method="post" class="row g-3">

                                            <div class="col-md-4">
                                                <label for="" class="form-label">Select Team Member:</label>
                                                <select asp-for="Id" name="Id" class="form-control" asp-items="@ViewBag.UserList" required>
                                                    <option value="" disabled selected>---  Select Team Member  ---</option>
                                                </select>

                                                <div class="row">
                                                    <div class="col-md-12 mt-3">
                                                        <button type="submit" class="btn btn-primary">Assign Leads</button>
                                                    </div>

                                                </div>
                                            </div>

                                            <div class="col-md-8">
                                                <!-- Add EJ2 Grid container -->
                                                <div id="grid"></div>

                                            </div>


                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>

        </section>

    </div>
</div>



@* 
<!-- partial -->
<div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <p class="card-title">Leads Allocation</p>
                        <div class="row">
                            <div class="col-12">
                                @if (TempData["SuccessMessage"] != null)
                                {
                                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                                        <strong>Success!</strong> @TempData["SuccessMessage"]
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                
                                <form asp-action="AssignLeadToEmployee" method="post" class="row g-3">

                                    <div class="col-md-4">
                                        <label for="" class="form-label">Select Team Member:</label>
                                        <select asp-for="Id" name="Id" class="form-control" asp-items="@ViewBag.UserList" required>
                                            <option value="" disabled selected>---  Select Team Member  ---</option>
                                        </select>

                                        <div class="row">
                                            <div class="col-md-12 mt-3">
                                                <button type="submit" class="btn btn-primary">Assign Leads</button>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-md-8">
                                        <!-- Add EJ2 Grid container -->
                                        <div id="grid"></div>

                                    </div>


                                </form>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>

    </div>

</div>
<!-- main-panel ends -->

 
 *@



<script>
    // Initialize EJ2 Grid
    document.addEventListener('DOMContentLoaded', function () {
        var leadsData = @Html.Raw(Json.Serialize(ViewBag.Leads));
        var showHeader = Array.isArray(leadsData) && leadsData.length > 0;

        var grid = new ej.grids.Grid({
            dataSource: leadsData,
            height: 200,  // Set an appropriate height
            columns: [
                // Custom checkbox column template for data records
                {
                    headerText: showHeader ? '' : '&nbsp;', // Leave headerText empty for no header
                    template: '<div style="display: flex; align-items: center;"><input type="checkbox" name="leadIds" value="${leadId}" class="form-check-input lead-checkbox" style="margin-right: 5px;" /><span style="flex-grow: 1;"></span></div>',
                    width: 50 // Set the desired width for the checkbox column
                },

                { field: 'firstName', headerText: 'First Name', width: 130 },
                { field: 'lastName', headerText: 'Last Name', width: 130 },
                { field: 'gender', headerText: 'Gender', width: 100 },
                { field: 'email', headerText: 'Email', width: 150 },
                { field: 'phoneNumber', headerText: 'Phone Number', width: 150 },
                { field: 'address', headerText: 'Address', width: 200 },
                { field: 'leadSource', headerText: 'Lead Source', width: 150 }
            ],
            allowPaging: false,
            showHeader: showHeader, // Set the visibility of the header based on data presence
        });
        grid.appendTo('#grid');

        // Add event listeners to checkboxes for updating the counter
        document.addEventListener('change', function (event) {
            if (event.target.classList.contains('lead-checkbox')) {
                updateLeadCounter();
            }
        });

        // Function to update the counter based on checked checkboxes
        function updateLeadCounter() {
            var selectedLeads = document.querySelectorAll('input.lead-checkbox:checked');
            var leadCounter = selectedLeads.length;
            document.getElementById('lead-counter').innerText = leadCounter;
        }
    });

    // Handle form submission
    document.querySelector('form').addEventListener('submit', function (event) {
        // Collect selected checkbox values
        var selectedLeadIds = Array.from(document.querySelectorAll('input[name="leadIds"]:checked'))
            .map(checkbox => checkbox.value);

        // Set the selected leadIds as a comma-separated string to a hidden input field
        document.querySelector('input[name="SelectedLeadIds"]').value = selectedLeadIds.join(',');

        // Continue with the form submission
        return true;
    });
</script>


 
