   <!-- Content Wrapper. Contains page content -->
   @model IEnumerable<LegalAndGeneralConsultantCRM.ViewModels.Leads.MessageVM>
@{
	var coldLeads = ViewBag.Cold;
	var hotLeads = ViewBag.Hot;
	var futureLeads = ViewBag.Fut;
	var deadLeads = ViewBag.DeadLead;
	var totalLeads = ViewBag.LeadCount;
}

<style>
	[type=button]:not(:disabled), [type=reset]:not(:disabled), [type=submit]:not(:disabled), button:not(:disabled) {
		cursor: pointer;
		background: #4e0973;
		color: white;
	}

	#activity-log-container {
		max-height: 650px; /* Adjust the height to display 5 logs */
		overflow-y: auto;
		padding-right: 10px; /* Space for the scrollbar */
	}
		/* Customize the scrollbar for WebKit browsers (Chrome, Safari) */
		#activity-log-container::-webkit-scrollbar {
			width: 6px; /* Slim scrollbar width */
		}

		#activity-log-container::-webkit-scrollbar-thumb {
			background-color: #888; /* Color of the scrollbar thumb */
			border-radius: 10px; /* Rounded scrollbar thumb */
			border: 2px solid #f0f0f0; /* Adds a border to create space between the thumb and track */
		}

			#activity-log-container::-webkit-scrollbar-thumb:hover {
				background-color: #555; /* Darker color when hovered */
			}

		#activity-log-container::-webkit-scrollbar-track {
			background-color: #f0f0f0; /* Background of the scrollbar track */
			border-radius: 10px; /* Rounded scrollbar track */
		}

	/* For Firefox */
	#activity-log-container {
		scrollbar-width: thin; /* Slim scrollbar width */
		scrollbar-color: #888 #f0f0f0; /* Thumb color and track color */
	}

	/* Scrollbar for IE and Edge */
	#activity-log-container {
		-ms-overflow-style: -ms-autohiding-scrollbar; /* Auto-hide scrollbar in Edge and IE */
	}

</style>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<div class="content-wrapper">
	<div class="content-wrapper-before"></div>
	<div class="container-full">
		<!-- Main content -->
		<section class="content">
			<div class="row">
				<div class="col-12 col-xl-4">
					<div class="box">
						<div class="box-header no-border">
							<h4 class="box-title">My Leads</h4>
							<ul class="box-controls pull-right">
								<li class="dropdown">
									<div class="dropdown-menu dropdown-menu-right">
										<a class="dropdown-item" href="#"><i class="ti-import"></i> Import</a>
										<a class="dropdown-item" href="#"><i class="ti-export"></i> Export</a>
										<a class="dropdown-item" href="#"><i class="ti-printer"></i> Print</a>
										<div class="dropdown-divider"></div>
										<a class="dropdown-item" href="#"><i class="ti-settings"></i> Settings</a>
									</div>
								</li>
							</ul>
						</div>
						<div class="box-body px-0">
							<div class="overflow-h" style="height: 339px;">
								<canvas id="leadChart" width="400" height="200"></canvas>
							</div>
							<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


							<script>
								$(document).ready(function () {
									// Ensure the canvas exists
									var ctx = document.getElementById('leadChart').getContext('2d');

									// Initialize the chart only if the canvas is found
									if (ctx) {
										var leadChart = new Chart(ctx, {
											type: 'bar', // 'bar', 'pie', 'line', etc.
											data: {
												labels: ['Cold Leads', 'Hot Leads', 'Future Leads', 'Dead Leads', 'Total Leads'],
												datasets: [{
													label: 'Lead Comparison',
													data: [
								@Html.Raw(ViewBag.Cold),
								@Html.Raw(ViewBag.Hot),
								@Html.Raw(ViewBag.Fut),
								@Html.Raw(ViewBag.DeadLead),
								@Html.Raw(ViewBag.LeadCount)
																								],
													backgroundColor: [
														'rgba(54, 162, 235, 0.2)', // Cold Leads
														'rgba(255, 99, 132, 0.2)', // Hot Leads
														'rgba(75, 192, 192, 0.2)', // Future Leads
														'rgba(153, 102, 255, 0.2)', // Dead Leads
														'rgba(255, 159, 64, 0.2)'  // Total Leads
													],
													borderColor: [
														'rgba(54, 162, 235, 1)', // Cold Leads
														'rgba(255, 99, 132, 1)', // Hot Leads
														'rgba(75, 192, 192, 1)', // Future Leads
														'rgba(153, 102, 255, 1)', // Dead Leads
														'rgba(255, 159, 64, 1)'  // Total Leads
													],
													borderWidth: 1
												}]
											},
											options: {
												scales: {
													y: {
														beginAtZero: true
													}
												}
											}
										});
									} else {
										console.error("Lead chart element not found");
									}
								});
							</script>


						</div>
						<div class="box-body py-0">
							<div class="row">
								<div class="col-6">
									<div class="d-flex align-items-center mb-30">
										<div class="mr-15 bg-primary-light h-50 w-50 l-h-60 rounded text-center">
											<span class="icon-Library font-size-24"><span class="path1"></span><span class="path2"></span></span>
										</div>
										<div class="d-flex flex-column font-weight-500">
											<a href="@Url.Action("FollowUpDetails", "Lead", new { area = "Admin", status = "Hot Lead" })" class="text-dark hover-primary mb-1 font-size-16">Hot Leads</a>
										</div>
									</div>
								</div>
								<div class="col-6">
									<div class="d-flex align-items-center mb-30">
										<div class="mr-15 bg-danger-light h-50 w-50 l-h-60 rounded text-center">
											<span class="icon-Write font-size-24"><span class="path1"></span><span class="path2"></span></span>
										</div>
										<div class="d-flex flex-column font-weight-500">
											<a href="@Url.Action("FollowUpDetails", "Lead", new { area = "Admin", status = "Future Lead" })" class="text-dark hover-danger mb-1 font-size-16">Future Leads</a>
										</div>
									</div>
								</div>
								<div class="col-6">
									<div class="d-flex align-items-center mb-30">
										<div class="mr-15 bg-success-light h-50 w-50 l-h-60 rounded text-center">
											<span class="icon-Group-chat font-size-24"><span class="path1"></span><span class="path2"></span></span>
										</div>
										<div class="d-flex flex-column font-weight-500">
											<a href="@Url.Action("FollowUpDetails", "Lead", new { area = "Admin", status = "Dead Lead" })" class="text-dark hover-success mb-1 font-size-16">Dead Leads</a>
										</div>
									</div>
								</div>
								<div class="col-6">
									<div class="d-flex align-items-center mb-30">
										<div class="mr-15 bg-info-light h-50 w-50 l-h-60 rounded text-center">
											<span class="icon-Attachment1 font-size-24"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></span>
										</div>
										<div class="d-flex flex-column font-weight-500">
											<a href="@Url.Action("FollowUpDetails", "Lead", new { area = "Admin", status = "Converted Lead" })" class="text-dark hover-info mb-1 font-size-16">Converted</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-xl-4 col-12">
					<div class="box">
						<div class="box-header no-border">
							<h4 class="box-title">  Activity Logs</h4>
							<ul class="box-controls pull-right">
								<li class="dropdown">
									<div class="dropdown-menu dropdown-menu-right">
										<a class="dropdown-item" href="#"><i class="ti-import"></i> Import</a>
										<a class="dropdown-item" href="#"><i class="ti-export"></i> Export</a>
										<a class="dropdown-item" href="#"><i class="ti-printer"></i> Print</a>
										<div class="dropdown-divider"></div>
										<a class="dropdown-item" href="#"><i class="ti-settings"></i> Settings</a>
									</div>
								</li>
							</ul>
						</div>

						<div class="box-body p-0">
							<div id="revenue6" class="text-dark"></div>
						</div>
						<div class="box-body pt-0">
							<div id="activity-log-container" class="container">
								<!-- Activity logs will be dynamically injected here -->
							</div>


						</div>
					</div>

				</div>
				<div class="col-xl-4 col-12">
					<div class="box">
						<div class="box-header">
							<h4 class="box-title">  Meeting & Events</h4>
						</div>
						<div class="box-body">
							<div class="row">


								<div id="calendarr"></div>

							</div>
						</div>
					</div>
					<div class="box box-body ull-up">
						<div class="flexbox align-items-end">
							<div>
								<span class="font-size-30 countnm">@ViewBag.Hot</span>
								<h6 class="text-uppercase text-dark-50 mb-0"> Hot Leads</h6>
							</div>
							<span class="icon-User font-size-80 text-info"><span class="path1"></span><span class="path2"></span></span>
						</div>
					</div>
					<div class="box box-body ull-up">
						<div class="flexbox align-items-end">
							<div>
								<span class="font-size-30 countnm">@ViewBag.Fee</span>
								<h6 class="text-uppercase text-dark-50 mb-0"> Consultation Fees </h6>
							</div>
							<span class="icon-money-bill font-size-80 text-info"><span class="path1"></span><span class="path2"></span></span>
						</div>
					</div>
				</div>



				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.LeadCount </h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto"> Leads</span>
							</div>
							<div>
								 Leads
							</div>
						</div>
						<div class="chart">
							<div id="spark1"></div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.Vis</h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto">Students  </span>

							</div>
							<div>
								 Enrolled Students
							</div>
						</div>
						<div class="chart">
							<div id="spark2"></div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.Vis</h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto"> Visa Application  </span>


							</div>
							<div>
								 Visa Application
							</div>
						</div>
						<div class="chart">
							<div id="spark3"></div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.StudentCount</h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto">Application</span>

							</div>
							<div>
								 Application Submitted
							</div>
						</div>
						<div class="chart">
							<div id="spark4"></div>
						</div>
					</div>
				</div>


				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.depostcount </h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto"> Deposits</span>
							</div>
							<div>
								 Deposits
							</div>
						</div>
						<div class="chart">
							<div id="spark1"></div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.Uni</h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto">   Universities  </span>

							</div>
							<div>
								 Universities
							</div>
						</div>
						<div class="chart">
							<div id="spark2"></div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.EmployeeCount</h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto">    Team Members </span>


							</div>
							<div>
								 Team Members
							</div>
						</div>
						<div class="chart">
							<div id="spark3"></div>
						</div>
					</div>
				</div>
				<div class="col-xl-3 col-lg-6 col-12">
					<div class="box">
						<div class="box-body">
							<div class="d-flex">
								<h3 class="font-weight-400 mb-0">@ViewBag.Branch</h3>
								<span class="badge badge-primary badge-pill align-self-center ml-auto">  Our Branches  </span>

							</div>
							<div>
								 Branches
							</div>
						</div>
						<div class="chart">
							<div id="spark4"></div>
						</div>
					</div>
				</div>

				<div class="col-xl-12 col-12">
					<div class="box">
						<div class="box-header">
							<h4 class="box-title">
								Our Customers , Converted Leads

							</h4>
						</div>
						<div class="box-body p-0">
							<div class="table-responsive">
								<table id="brandTable" class="display expandable-table" style="width:100%">
									<thead class="thead-dark">
										<tr>
											<th style="background-color: #4e0973;color:white;">First Name</th>
											<th style="background-color: #4e0973;color:white;">Last Name</th>
											<th style="background-color: #4e0973;color:white;">Phone Number</th>
											<th style="background-color: #4e0973;color:white;">Email  </th>
											<th style="background-color: #4e0973;color:white;">Status</th>
											<th style="background-color: #4e0973;color:white;">Converted By</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>

							</div>
						</div>
					</div>
				</div>

			</div>
		</section>
		<!-- /.content -->
	</div>
</div>
<!-- /.content-wrapper -->
<div class="modal fade" id="eventModal" tabindex="-1" role="dialog" aria-labelledby="eventModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="eventModalLabel">Meeting Details</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form id="eventForm">
				<input type="hidden" id="eventId" name="eventId">

				<div class="modal-body">
					<div class="form-group">
						<label for="leadId">Meeting or Event Name</label>
						<input type="text" class="form-control" id="name" name="name" readonly>

					</div>
						<div class="form-group">
						<label for="leadId">User Name</label>
						<input type="text" class="form-control" id="User" name="name" readonly>

					</div>
					<div class="form-group">
						<label for="eventDescription">Description</label>
						<textarea class="form-control" id="eventDescription" name="description" rows="3" readonly></textarea>
					</div>
					<div class="form-group">
						<label for="eventStart">Event Date</label>
						<input type="datetime-local" class="form-control" id="eventStart" name="eventStart" readonly>
					</div>
					<div class="form-group">
						<label for="eventThemeColor">Theme Color</label>
						<select class="form-control" id="eventThemeColor" name="themeColor" readonly>
							<option value="red">Red</option>
							<option value="blue">Blue</option>
							<option value="green">Green</option>
							<option value="yellow">Yellow</option>
						</select>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary">Save</button>
					<button type="button" class="btn btn-danger" id="deleteEventButton">Delete</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				</div>
			</form>
		</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

@section Scripts {

	<script>
		$(document).ready(function () {
			var ctx = document.getElementById('leadChart').getContext('2d');
			var leadChart = new Chart(ctx, {
				type: 'bar', // You can use 'pie', 'line', etc. for different chart types
				data: {
					labels: ['Cold Leads', 'Hot Leads', 'Future Leads', 'Dead Leads', 'Total Leads'],
					datasets: [{
						label: 'Lead Comparison',
						data: [
		@coldLeads,
		@hotLeads,
		@futureLeads,
		@deadLeads,
		@totalLeads
								],
						backgroundColor: [
							'rgba(54, 162, 235, 0.2)', // Cold Leads
							'rgba(255, 99, 132, 0.2)', // Hot Leads
							'rgba(75, 192, 192, 0.2)', // Future Leads
							'rgba(153, 102, 255, 0.2)', // Dead Leads
							'rgba(255, 159, 64, 0.2)'  // Total Leads
						],
						borderColor: [
							'rgba(54, 162, 235, 1)', // Cold Leads
							'rgba(255, 99, 132, 1)', // Hot Leads
							'rgba(75, 192, 192, 1)', // Future Leads
							'rgba(153, 102, 255, 1)', // Dead Leads
							'rgba(255, 159, 64, 1)'  // Total Leads
						],
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						y: {
							beginAtZero: true
						}
					}
				}
			});
			// Initialize FullCalendar
			$('#calendarr').fullCalendar({
				header: {
					left: 'prev,next today',
					center: 'title',
					right: 'month,agendaWeek,agendaDay'
				},
				editable: true, // Enable editing (dragging, resizing)
				events: '/Admin/Meeting/GetEvents',
				eventClick: function (calEvent, jsEvent, view) {
					$('#eventModalLabel').text('Edit Meeting');
					$('#name').val(calEvent.title); // Set name
					$('#User').val(calEvent.userFirstName); // Set name
					$('#eventDescription').val(calEvent.description);
					$('#eventStart').val(moment(calEvent.start).format('YYYY-MM-DD'));
					$('#eventThemeColor').val(calEvent.color); // Set color picker value or select option
					$('#eventId').val(calEvent.id); // Store the event ID in a hidden field
					$('#eventModal').modal('show');
				},
				dayClick: function (date, jsEvent, view) {
					$('#eventModalLabel').text('Create Meeting');
					$('#eventDescription').val('');
					$('#name').val('');
					$('#eventStart').val(moment(date).format('YYYY-MM-DD'));
					$('#eventThemeColor').val('red'); // Set default color if needed
					$('#eventId').val(''); // Clear the event ID hidden field
					$('#eventModal').modal('show');
				}
			});

			// Handle form submission for creating or updating events
			$('#eventForm').submit(function (event) {
				event.preventDefault();
				var eventId = $('#eventId').val();
				var eventData = {
					CalendarEventId: eventId,
					Description: $('#eventDescription').val(),
					Name: $('#name').val(),
					EventDate: $('#eventStart').val(),
					ThemeColor: $('#eventThemeColor').val()
				};

				var url = eventId ? '/Admin/Meeting/UpdateEvent' : '/Admin/Meeting/AddEvent';

				$.ajax({
					type: 'POST',
					url: url,
					data: eventData,
					success: function (data) {
						if (data.success) {
							$('#calendarr').fullCalendar('refetchEvents'); // Reload events
							$('#eventModal').modal('hide');
						} else {
							alert('Failed to save event.');
						}
					},
					error: function () {
						alert('Error occurred. Please try again.');
					}
				});
			});

			// Handle event delete
			$('#deleteEventButton').click(function () {
				var eventId = $('#eventId').val();

				if (eventId) {
					if (confirm('Are you sure you want to delete this event?')) {
						$.ajax({
							type: 'POST',
							url: '/Admin/Meeting/DeleteEvent',
							data: { id: eventId },
							success: function (data) {
								if (data.success) {
									$('#calendarr').fullCalendar('refetchEvents'); // Reload events
									$('#eventModal').modal('hide');
								} else {
									alert('Failed to delete event.');
								}
							},
							error: function () {
								alert('Error occurred. Please try again.');
							}
						});
					}
				}
			});
		});
		$(document).ready(function () {
			$('#brandTable').DataTable({
				"ajax": {
					"url": "/Admin/Customer/GetFollowUpData",  // Corrected action name
					"type": "GET",
					"datatype": "json"
				},
				"columns": [
					{ "data": "leadFirstNAme", "autoWidth": true },
					{ "data": "leadLastName", "autoWidth": true },
					{ "data": "phoneNo", "autoWidth": true },
					{ "data": "email", "autoWidth": true },
					{
						"data": "followUpStatus",
						"name": "Status",
						"autoWidth": true,
						"render": function (data, type, row) {
							// Check if the followUpStatus is "Converted Lead" and apply the badge
							if (data === "Converted Lead") {
								return '<span class="badge bg-success text-white">Converted Lead</span>';
							}
							// Check if the followUpStatus is "Dead Lead" and apply the badge
							else if (data === "Dead Lead") {
								return '<span class="badge bg-danger">Dead Lead</span>';
							}
							else if (data === "Cold Lead") {
								return '<span class="badge bg-dark">Cold Lead</span>';
							}
							// Check if the followUpStatus is "Future Lead" and apply the badge
							else if (data === "Future Lead") {
								return '<span class="badge bg-secondary">Future Lead</span>';
							}
							// Check if the followUpStatus is "Hot Lead" and apply the badge
							else if (data === "Hot Lead") {
								return '<span class="badge bg-primary">Hot Lead</span>';
							}
							// Check if the followUpStatus is "Warm Lead" and apply the badge
							else if (data === "Warm Lead") {
								return '<span class="badge bg-info">Warm Lead</span>';
							} else {
								// You can add more conditions for other statuses if needed
								return '<span class="badge bg-warning">Pending Lead</span>';
							}
						}
					},
					{ "data": "firstName", "name": "Converted By", "autoWidth": true },
				],
				"language": {
					"emptyTable": "No data available"
				}
			});
			$('.dataTables_length').hide(); // Hide the 'Show entries' dropdown
		});

		$(document).ready(function () {
			$.ajax({
				url: '/Admin/Dashboard/GetUserActivity', // Replace with your controller's route
				type: 'GET',
				success: function (response) {
					var container = $('#activity-log-container');
					container.empty(); // Clear any existing content

					if (response.data && response.data.length > 0) {
						$.each(response.data, function (index, activityLog) {
							var logHtml = `
												<div class="d-flex align-items-center mb-20">
													<div class="d-flex flex-column flex-grow-1 mr-2 font-weight-500">
														<div class="row mb-2">
															<div class="col-auto">
																<img src="https://adminto-dashboard-template.multipurposethemes.com/images/svg-icon/color-svg/002-google.svg" class="h-30" alt="">
															</div>
															<div class="col">
																<a href="#" class="text-dark hover-primary mb-1 font-size-16">
																	User: ${activityLog.userName}
																</a>
																<div class="text-fade">
																	${new Date(activityLog.activityLogDate).toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' })}
																</div>
																<div>
																	Action: ${activityLog.action}
																</div>
																<div>
																	Lead: ${activityLog.fullName}
																</div>
															</div>
														</div>
														<hr />
													</div>
												</div>`;
							container.append(logHtml);
						});
					} else {
						container.append('<p>No activity logs found for today.</p>');
					}
				},
				error: function () {
					$('#activity-log-container').html('<p>There was an error loading the activity logs.</p>');
				}
			});
		});


	</script>
}


