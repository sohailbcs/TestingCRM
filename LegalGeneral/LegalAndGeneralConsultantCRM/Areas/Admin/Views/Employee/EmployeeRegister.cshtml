@model LegalAndGeneralConsultantCRM.ViewModels.Employee.EmployeeRegisterViewModel

<!-- Include Toastr CSS and JS, jQuery, and FontAwesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
<div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="container-full">


        <!-- Main content -->
        <section class="content">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="d-flex align-items-center">
                    <div class="w-p100 d-md-flex align-items-center justify-content-between">
                        <h3 class="page-title">   </h3>
                        <div class="d-inline-block align-items-center">
                            <nav>
                                <ol class="breadcrumb">
                                </ol>
                            </nav>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">

                <div class="col-12">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title"> Team Member Account</h3>
                            <div class="float-right">
                            </div>
                        </div>

                      

                        <!-- /.box-header -->
                        <div class="box-body">

                            <div class="p-5" style="background-color:#ECEEF7;padding:20px!important; border-radius:10px;">
                                <div asp-validation-summary="All" class="text-danger"></div>

                                <form class="forms-sample" asp-action="EmployeeRegister" id="EmployeeRegister" method="post" asp-area="Admin">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="FirstName">First Name</label>
                                                <input type="text" class="form-control" asp-for="FirstName" placeholder="First Name" required>
                                                <span asp-validation-for="FirstName" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="LastName">Last Name</label>
                                                <input type="text" class="form-control" asp-for="LastName" placeholder="Last Name" required>
                                                <span asp-validation-for="LastName" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="Email">Email</label>
                                                <input type="email" class="form-control" asp-for="Email" placeholder="Email" required>
                                                <span asp-validation-for="Email" class="text-danger"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="PhoneNumber">Phone Number</label>
                                                <input type="text" class="form-control" asp-for="PhoneNumber" placeholder="Phone Number" required pattern="\d{11,16}" title="Phone number must be between 11 and 16 digits long">
                                                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="Gender">Gender</label>
                                                <select asp-for="Gender" class="form-control" required>
                                                    <option value="">--- Select Gender ---</option>
                                                    <option value="Male">Male</option>
                                                    <option value="Female">Female</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                                <span asp-validation-for="Gender" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="TeamMemeberType">Team Member Type</label>
                                                <select asp-for="TeamMemeberType" class="form-control" required>
                                                    <option value="">--- Select Team Member Type ---</option>
                                                    <option value="Sale Team">Sales Team</option>
                                                    <option value="Team Leader">Team Leader</option>
                                                    <option value="Partner">Partner</option>
                                                </select>
                                                <span asp-validation-for="TeamMemeberType" class="text-danger"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="BranchType">Branch Type</label>
                                                <select id="BranchTypeSelect" class="form-control" required>
                                                    <option value="" disabled selected>--- Select Branch Type ---</option>
                                                    @foreach (var branchType in (SelectList)ViewBag.BranchTypes)
                                                    {
                                                        <option value="@branchType.Text">@branchType.Text</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="BranchType">Application Processor</label>
                                                <select  asp-for="Applicationprocessor" class="form-control" required>
                                                    <option value="" disabled selected>--- Select Option ---</option>
                                                    <option value=true>YES</option>
                                                    <option value=false>No</option>
                                                   
                                                </select>
                                            </div>
                                        </div>


                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="BrandId">Branch</label>
                                                <select asp-for="BrandId" class="form-control" id="BranchSelect" required>
                                                    <option value="" disabled selected>--- Select Branch ---</option>
                                                </select>
                                                <span asp-validation-for="BrandId" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="Password">Password</label>
                                                <div class="input-group">
                                                    <input type="password" class="form-control" asp-for="Password" id="Password" placeholder="Password" required>
                                                    <div class="input-group-append">
                                                        <span class="input-group-text" id="togglePassword">
                                                            <i class="fas fa-eye"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <span asp-validation-for="Password" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="ConfirmPassword">Confirm Password</label>
                                                <div class="input-group">
                                                    <input type="password" class="form-control" asp-for="ConfirmPassword" id="ConfirmPassword" placeholder="Confirm Password" required>
                                                    <div class="input-group-append">
                                                        <span class="input-group-text" id="toggleConfirmPassword">
                                                            <i class="fas fa-eye"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-primary mr-2">Submit</button>
                                    <a href="/Admin/Employee/User" class="btn btn-light">Cancel</a>
                                </form>
                                </<div>
                           
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>

        </section>

    </div>
</div>




@* <div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Team Member</h4>

                        <!-- Display validation summary -->
                        <div asp-validation-summary="All" class="text-danger"></div>

                        <form class="forms-sample" asp-action="EmployeeRegister" id="EmployeeRegister" method="post" asp-area="Admin">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="FirstName">First Name</label>
                                        <input type="text" class="form-control" asp-for="FirstName" placeholder="First Name" required>
                                        <span asp-validation-for="FirstName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="LastName">Last Name</label>
                                        <input type="text" class="form-control" asp-for="LastName" placeholder="Last Name" required>
                                        <span asp-validation-for="LastName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="Email">Email</label>
                                        <input type="email" class="form-control" asp-for="Email" placeholder="Email" required>
                                        <span asp-validation-for="Email" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="PhoneNumber">Phone Number</label>
                                        <input type="text" class="form-control" asp-for="PhoneNumber" placeholder="Phone Number" required pattern="\d{11,16}" title="Phone number must be between 11 and 16 digits long">
                                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="Gender">Gender</label>
                                        <select asp-for="Gender" class="form-control" required>
                                            <option value="">--- Select Gender ---</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                        <span asp-validation-for="Gender" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="TeamMemeberType">Team Member Type</label>
                                        <select asp-for="TeamMemeberType" class="form-control" required>
                                            <option value="">--- Select Team Member Type ---</option>
                                            <option value="Sale Team">Sales Team</option>
                                            <option value="Team Leader">Team Leader</option>
                                            <option value="Partner">Partner</option>
                                        </select>
                                        <span asp-validation-for="TeamMemeberType" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="BrandId">Branch</label>
                                        <select asp-for="BrandId" class="form-control" id="BranchSelect" asp-items="@ViewBag.Branches" required>
                                            <option value="" disabled selected>--- Select Branch ---</option>
                                        </select>
                                        <span asp-validation-for="BrandId" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="Password">Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" asp-for="Password" id="Password" placeholder="Password" required>
                                            <div class="input-group-append">
                                                <span class="input-group-text" id="togglePassword">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <span asp-validation-for="Password" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="ConfirmPassword">Confirm Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" asp-for="ConfirmPassword" id="ConfirmPassword" placeholder="Confirm Password" required>
                                            <div class="input-group-append">
                                                <span class="input-group-text" id="toggleConfirmPassword">
                                                    <i class="fas fa-eye"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary mr-2">Submit</button>
                            <a href="/Admin/Employee/User" class="btn btn-light">Cancel</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
 *@

<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
    $(document).ready(function () {
        // Trigger AJAX request when Branch Type is selected
        $('#BranchTypeSelect').change(function () {
            var branchType = $('#BranchTypeSelect').val();
            console.log("Branch type selected: " + branchType);
            // Clear the existing branch options
            $('#BranchSelect').empty();
            
            if (branchType) {
                // Make AJAX call to fetch branches by type
                $.ajax({
                    url: '/Admin/Employee/GetBranchesByType',
                    type: 'GET',
                    data: { branchType: branchType },
                    success: function (data) {
                        // Populate the Branch dropdown with the filtered branches
                        $('#BranchSelect').empty(); // Clear existing options
                        $.each(data, function (index, branch) {
                            $('#BranchSelect').append($('<option>', {
                                value: branch.branchId,
                                text: branch.branchName
                            }));
                        });
                    }
                });
            }
        });

        // Form submission validation
        $('form').submit(function (event) {
            var isValid = true;
            var namePattern = /^(?![0-9]*$)[a-zA-Z0-9 ]{3,}$/;

            var firstName = $('input[name="FirstName"]').val();
            if (!namePattern.test(firstName)) {
                isValid = false;
                $('span[data-valmsg-for="FirstName"]').text("First Name must be at least 3 characters long and cannot be only numbers");
            } else {
                $('span[data-valmsg-for="FirstName"]').text("");
            }

            var lastName = $('input[name="LastName"]').val();
            if (!namePattern.test(lastName)) {
                isValid = false;
                $('span[data-valmsg-for="LastName"]').text("Last Name must be at least 3 characters long and cannot be only numbers");
            } else {
                $('span[data-valmsg-for="LastName"]').text("");
            }

            if (!isValid) {
                event.preventDefault();
            }
        });

        // Save the initial options for the Branch dropdown
        var initialBranchOptions = $('#BranchSelect').html();

        // Employee registration form validation
        $('#EmployeeRegister').submit(function (event) {
            var password = $('input[name="Password"]').val();
            var confirmPassword = $('input[name="ConfirmPassword"]').val();
            var passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@@$!%*?&^#])[A-Za-z\d@@$!%*?&^#]{8,}$/;

            // Check if password and confirm password match
            if (password !== confirmPassword) {
                toastr.error('The password and confirmation password do not match.');
                event.preventDefault(); // Prevent form submission
                return;
            }

            // Check if password matches the pattern
            if (!passwordPattern.test(password)) {
                toastr.error('Password must be at least 8 characters long, contain at least one lowercase letter, one uppercase letter, one number, and one special character.');
                event.preventDefault(); // Prevent form submission
                return;
            }
        });

        // Display success or error messages from TempData
        var errorMessage = '@TempData["Error"]';
        var successMessage = '@TempData["Success"]';

        if (errorMessage) {
            toastr.error(errorMessage);
        }

        if (successMessage) {
            // Optionally clear the form fields except for the dropdown
            $('#EmployeeRegister')[0].reset();
            // Restore the initial options to ensure dropdown is populated correctly
            $('#BranchSelect').html(initialBranchOptions);
            toastr.success(successMessage);
        }

        // Toggle password visibility
        $('#togglePassword').click(function () {
            var passwordField = $('#Password');
            var icon = $(this).find('i');
            if (passwordField.attr('type') === 'password') {
                passwordField.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                passwordField.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });

        $('#toggleConfirmPassword').click(function () {
            var confirmPasswordField = $('#ConfirmPassword');
            var icon = $(this).find('i');
            if (confirmPasswordField.attr('type') === 'password') {
                confirmPasswordField.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                confirmPasswordField.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });
    });
</script>
