@{
    ViewData["Title"] = "Franchises";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="container-full">
        <section class="content">
<h1>Franchises</h1>

<!-- Button to open the modal -->
<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addFranchiseModal">Add New Franchise</button>

<!-- DataTable -->
<table id="franchisesTable" class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>City</th>
            <th>Code</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be populated here by DataTables -->
    </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="addFranchiseModal" tabindex="-1" aria-labelledby="addFranchiseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addFranchiseModalLabel">Add New Franchise</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addFranchiseForm">
                    <div class="mb-3">
                        <label for="FrenchiseName" class="form-label">Branch Name</label>
                        <input type="text" class="form-control" id="FrenchiseName" name="FrenchiseName" required>
                    </div>
                    <div class="mb-3">
                        <label for="City" class="form-label">City</label>
                        <input type="text" class="form-control" id="City" name="City">
                    </div>
                    <div class="mb-3">
                        <label for="FrenchiseCode" class="form-label">Branch Code</label>
                        <input type="text" class="form-control" id="FrenchiseCode" name="FrenchiseCode" required>
                    </div>
                    <div class="mb-3">
                        <label for="Description" class="form-label">Description</label>
                        <textarea class="form-control" id="Description" name="Description"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>
@section Scripts {
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#franchisesTable').DataTable({
                ajax: {
                    url: '@Url.Action("GetFranchises")',
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'frenchiseId' },
                    { data: 'frenchiseName' },
                    { data: 'city' },
                    { data: 'frenchiseCode' },
                    { data: 'description' }
                ]
            });

            $('#addFranchiseForm').on('submit', function(e) {
                e.preventDefault();

                $.ajax({
                    url: '@Url.Action("Create")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function(result) {
                        $('#addFranchiseModal').modal('hide');
                        $('#franchisesTable').DataTable().ajax.reload();
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                    }
                });
            });
        });
    </script>
}
